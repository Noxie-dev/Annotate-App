var c=Object.defineProperty;var u=(r,e,t)=>e in r?c(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>u(r,typeof e!="symbol"?e+"":e,t);class l{constructor(){n(this,"baseUrl","http://localhost:3001")}async initiateOAuth(e,t){const a=new URLSearchParams({provider:e,redirect_url:t||window.location.origin+"/auth/callback",state:this.generateState()});sessionStorage.setItem("oauth_state",a.get("state")),window.location.href=`${this.baseUrl}/auth/oauth/initiate?${a}`}async handleOAuthCallback(e,t,a){const i=sessionStorage.getItem("oauth_state");if(t!==i)throw new Error("Invalid OAuth state parameter");sessionStorage.removeItem("oauth_state");try{const o=await fetch(`${this.baseUrl}/auth/oauth/callback`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,state:t,provider:a})});if(!o.ok)throw new Error("OAuth authentication failed");const s=await o.json();return this.mapOAuthResponse(s)}catch(o){throw console.error("OAuth callback error:",o),new Error("Failed to complete OAuth authentication")}}async simulateOAuthFlow(e){await new Promise(i=>setTimeout(i,1e3));const t=this.generateMockOAuthResult(e);sessionStorage.setItem("mock_oauth_result",JSON.stringify(t));const a=new URL("/auth/callback",window.location.origin);a.searchParams.set("code","mock_code_"+Date.now()),a.searchParams.set("state",sessionStorage.getItem("oauth_state")),a.searchParams.set("provider",e),window.location.href=a.toString()}getMockOAuthResult(){const e=sessionStorage.getItem("mock_oauth_result");return e?(sessionStorage.removeItem("mock_oauth_result"),JSON.parse(e)):null}generateMockOAuthResult(e){const t={id:`${e}_${Date.now()}`,email:`user@${e==="google"?"gmail.com":"github.com"}`,emailVerified:!0,name:e==="google"?"Google User":"GitHub User",avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e}`,role:{id:"team-member",name:"Team Member",description:"Standard team member with document access",permissions:["view_documents","edit_documents","add_comments"],level:1},permissions:["view_documents","edit_documents","add_comments"],sessionId:this.generateSessionId(),lastLoginAt:new Date().toISOString(),mfaEnabled:!1},a={id:t.id,name:t.name,email:t.email,avatar:t.avatar,role:t.role.name,status:"online",color:e==="google"?"#4285f4":"#333",department:"Engineering",joinDate:new Date().toISOString().split("T")[0],timezone:"UTC",isFirstTimeUser:!0,lastLoginAt:t.lastLoginAt,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return{user:t,profile:a,isNewUser:!0}}mapOAuthResponse(e){var t,a;return{user:{id:e.user.id,email:e.user.email,emailVerified:e.user.email_verified||!0,name:e.user.name||e.user.display_name,avatar:e.user.avatar_url||e.user.picture,role:e.user.role||{id:"team-member",name:"Team Member",description:"Standard team member with document access",permissions:["view_documents","edit_documents","add_comments"],level:1},permissions:e.user.permissions||["view_documents","edit_documents","add_comments"],sessionId:e.session_id,lastLoginAt:new Date().toISOString(),mfaEnabled:e.user.mfa_enabled||!1},profile:{id:e.user.id,name:e.user.name||e.user.display_name,email:e.user.email,avatar:e.user.avatar_url||e.user.picture,role:((t=e.user.role)==null?void 0:t.name)||"Team Member",status:"online",color:e.user.color||"#3b82f6",department:e.user.department||"Engineering",joinDate:((a=e.user.created_at)==null?void 0:a.split("T")[0])||new Date().toISOString().split("T")[0],timezone:e.user.timezone||"UTC",isFirstTimeUser:e.is_new_user||!1,lastLoginAt:new Date().toISOString(),createdAt:e.user.created_at||new Date().toISOString(),updatedAt:e.user.updated_at||new Date().toISOString()},isNewUser:e.is_new_user||!1}}generateState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}generateSessionId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}async linkSocialAccount(e,t){try{if(!(await fetch(`${this.baseUrl}/auth/oauth/link`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.getAuthToken()}`},body:JSON.stringify({provider:e,user_id:t})})).ok)throw new Error("Failed to link social account")}catch(a){throw console.error("Link social account error:",a),new Error("Failed to link social account")}}async unlinkSocialAccount(e,t){try{if(!(await fetch(`${this.baseUrl}/auth/oauth/unlink`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.getAuthToken()}`},body:JSON.stringify({provider:e,user_id:t})})).ok)throw new Error("Failed to unlink social account")}catch(a){throw console.error("Unlink social account error:",a),new Error("Failed to unlink social account")}}getAuthToken(){return localStorage.getItem("auth_token")}}const d=new l;export{d as s};
