import{j as e}from"./radix-ui-Dm4GcI-M.js";import{u as ie,a as u,L as K,c as ne}from"./react-vendor-BxpQIQ7B.js";import{B as f}from"./button-BU14-tcR.js";import{I as P}from"./input-B_Pc9ca6.js";import{A as de,a as me,b as he}from"./avatar-Dqh11rFN.js";import{F as ue,s as ge,u as xe}from"./index-CeiQEl0I.js";import{c as fe}from"./data-vendor-7zrJSdJt.js";import{u as v,A as pe,k as be,o as ye,p as ve,g as E,q as V,r as H,s as je,n as we,D as Ne,t as Fe,i as J,v as Se,a as ke,L as Ce}from"./utils-vendor-DzewcVAv.js";import"./pdf-vendor-BQ5_-Qxz.js";const De=fe((o,x)=>({files:[],folders:[],currentFolderId:null,isLoading:!1,error:null,selectedItems:new Set,searchQuery:"",uploadProgress:{},isUploading:!1,fileStorageService:new ue("http://localhost:3001",ge.upload),loadFiles:async(l=null)=>{o({isLoading:!0,error:null});try{const{fileStorageService:s}=x(),a=await s.getFiles(l);o({files:a.files,folders:a.folders,currentFolderId:l,isLoading:!1,selectedItems:new Set})}catch(s){console.error("Failed to load files:",s),o({isLoading:!1,error:s instanceof Error?s.message:"Failed to load files"})}},uploadFile:async(l,s)=>{var d;const{fileStorageService:a,currentFolderId:t}=x(),g=`${Date.now()}-${Math.random()}`;try{o(m=>({isUploading:!0,uploadProgress:{...m.uploadProgress,[g]:0}}));const h={...s,folderId:t},b=setInterval(()=>{o(m=>{const y=m.uploadProgress[g]||0;return y<90?{uploadProgress:{...m.uploadProgress,[g]:y+10}}:m})},200),p=await a.uploadFile(l,h);return clearInterval(b),o(m=>({uploadProgress:{...m.uploadProgress,[g]:100}})),((d=p.metadata)==null?void 0:d.folderId)===t&&o(m=>({files:[...m.files,p]})),setTimeout(()=>{o(m=>{const y={...m.uploadProgress};return delete y[g],{uploadProgress:y,isUploading:Object.keys(y).length>0}})},2e3),p}catch(h){throw console.error("Upload failed:",h),o(b=>{const p={...b.uploadProgress};return delete p[g],{uploadProgress:p,isUploading:Object.keys(p).length>0,error:h instanceof Error?h.message:"Upload failed"}}),h}},deleteFile:async l=>{try{const{fileStorageService:s}=x();await s.deleteFile(l),o(a=>({files:a.files.filter(t=>t.id!==l),selectedItems:new Set([...a.selectedItems].filter(t=>t!==l))}))}catch(s){throw console.error("Delete file failed:",s),o({error:s instanceof Error?s.message:"Failed to delete file"}),s}},deleteFolder:async l=>{try{const{fileStorageService:s}=x();await s.deleteFolder(l),o(a=>({folders:a.folders.filter(t=>t.id!==l),selectedItems:new Set([...a.selectedItems].filter(t=>t!==l))}))}catch(s){throw console.error("Delete folder failed:",s),o({error:s instanceof Error?s.message:"Failed to delete folder"}),s}},createFolder:async(l,s=null)=>{try{const{fileStorageService:a,currentFolderId:t}=x(),g=await a.createFolder(l,s||t);return g.parentId===t&&o(d=>({folders:[...d.folders,g]})),g}catch(a){throw console.error("Create folder failed:",a),o({error:a instanceof Error?a.message:"Failed to create folder"}),a}},shareFile:async(l,s,a)=>{try{const{fileStorageService:t}=x();await t.shareFile({fileId:l,email:s,accessLevel:a})}catch(t){throw console.error("Share file failed:",t),o({error:t instanceof Error?t.message:"Failed to share file"}),t}},searchFiles:async l=>{o({isLoading:!0,error:null,searchQuery:l});try{const{fileStorageService:s,currentFolderId:a}=x(),t=await s.searchFiles(l,a);o({files:t.files,folders:t.folders,isLoading:!1})}catch(s){console.error("Search failed:",s),o({isLoading:!1,error:s instanceof Error?s.message:"Search failed"})}},downloadFile:async l=>{try{const{fileStorageService:s}=x(),a=await s.getDownloadUrl(l),t=document.createElement("a");t.href=a,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(s){throw console.error("Download failed:",s),o({error:s instanceof Error?s.message:"Download failed"}),s}},setCurrentFolder:l=>{o({currentFolderId:l})},setSelectedItems:l=>{o({selectedItems:l})},setSearchQuery:l=>{o({searchQuery:l})},clearError:()=>{o({error:null})},deleteSelectedItems:async()=>{const{selectedItems:l,deleteFile:s,deleteFolder:a,files:t,folders:g}=x(),d=[];for(const h of l)try{const b=t.some(m=>m.id===h),p=g.some(m=>m.id===h);b?await s(h):p&&await a(h)}catch(b){d.push(`Failed to delete item ${h}: ${b instanceof Error?b.message:"Unknown error"}`)}d.length>0&&o({error:d.join(`
`)})},moveFiles:async(l,s)=>{try{console.log("Moving files:",l,"to folder:",s);const{loadFiles:a,currentFolderId:t}=x();await a(t)}catch(a){throw console.error("Move files failed:",a),o({error:a instanceof Error?a.message:"Failed to move files"}),a}}}));function Qe(){var G;const{user:o}=xe(),x=ie(),{files:l,folders:s,currentFolderId:a,isLoading:t,error:g,selectedItems:d,searchQuery:h,uploadProgress:b,isUploading:p,loadFiles:m,uploadFile:y,deleteFile:Ie,deleteFolder:Pe,createFolder:L,shareFile:Ee,searchFiles:U,downloadFile:$,setCurrentFolder:N,setSelectedItems:F,setSearchQuery:z,clearError:A,deleteSelectedItems:M}=De(),[X,C]=u.useState(!1),[j,D]=u.useState(""),[Y,B]=u.useState(!1),[O,T]=u.useState(null),[Q,I]=u.useState(!1);u.useEffect(()=>{m(a)},[a,m]),u.useEffect(()=>{g&&(v.error(g),A())},[g,A]);const Z=u.useCallback(r=>{if(!r)return[];const c=[];let n=r;for(;n;){const i=s.find(w=>w.id===n);if(i)c.unshift(i),n=i.parentId;else break}return c},[s]),S=u.useMemo(()=>{if(h)return{folders:s,files:l};const r=s.filter(n=>n.parentId===a),c=l.filter(n=>{var i;return((i=n.metadata)==null?void 0:i.folderId)===a});return{folders:r,files:c}},[s,l,a,h]),k=u.useCallback(async r=>{const c=Array.from(r);for(const n of c)try{await y(n,{title:n.name.replace(/\.[^/.]+$/,""),description:"",tags:[],isPrivate:!0,accessLevel:"private"}),v.success(`${n.name} uploaded successfully`)}catch(i){console.error("Upload failed:",i),v.error(`Failed to upload ${n.name}: ${i instanceof Error?i.message:"Unknown error"}`)}},[y]),_=u.useCallback(r=>{r.preventDefault(),I(!0)},[]),q=u.useCallback(r=>{r.preventDefault(),I(!1)},[]),ee=u.useCallback(r=>{r.preventDefault(),I(!1);const c=r.dataTransfer.files;c.length>0&&k(c)},[k]),W=u.useCallback(async()=>{if(j.trim())try{await L(j.trim(),a),D(""),C(!1),v.success("Folder created successfully")}catch(r){console.error("Create folder failed:",r),v.error(`Failed to create folder: ${r instanceof Error?r.message:"Unknown error"}`)}},[j,a,L]),re=u.useCallback(async()=>{try{await M(),v.success("Items deleted successfully")}catch(r){console.error("Delete failed:",r),v.error(`Failed to delete items: ${r instanceof Error?r.message:"Unknown error"}`)}},[M]),se=u.useCallback(r=>{T(r),B(!0)},[]),ae=u.useCallback(r=>{x(`/document/${r.id}`)},[x]),te=u.useCallback(async r=>{z(r),r.trim()?await U(r):await m(a)},[U,m,a,z]),le=u.useCallback(async r=>{try{await $(r),v.success("Download started")}catch(c){console.error("Download failed:",c),v.error(`Download failed: ${c instanceof Error?c.message:"Unknown error"}`)}},[$]),oe=r=>{switch(r){case"private":return e.jsx(Ce,{className:"w-4 h-4 text-gray-400"});case"view":return e.jsx(ke,{className:"w-4 h-4 text-blue-400"});case"edit":return e.jsx(J,{className:"w-4 h-4 text-green-400"});default:return e.jsx(Se,{className:"w-4 h-4 text-orange-400"})}},R=Z(a),ce=r=>{if(r===0)return"0 Bytes";const c=1024,n=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(r)/Math.log(c));return parseFloat((r/Math.pow(c,i)).toFixed(2))+" "+n[i]};return e.jsxs("div",{className:"h-screen bg-[#0f1419] flex flex-col",children:[e.jsx("div",{className:"bg-[#1a1f2e] border-b border-gray-700 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"A"})}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-200",children:"Document Library"})]}),e.jsxs("nav",{className:"flex items-center space-x-4",children:[e.jsx(K,{to:"/dashboard",className:"text-gray-400 hover:text-white px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent hover:border-gray-600",children:"Dashboard"}),e.jsx(K,{to:"/doc-library",className:"text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium border-b-2 border-blue-500",children:"Doc Library"})]}),R.length>0&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[e.jsx("button",{type:"button",onClick:()=>N(null),className:"hover:text-gray-200 transition-colors","aria-label":"Navigate to root folder",children:"Root"}),R.map((r,c)=>e.jsxs(ne.Fragment,{children:[e.jsx("span",{children:"/"}),e.jsx("button",{type:"button",onClick:()=>N(r.id),className:"hover:text-gray-200 transition-colors","aria-label":`Navigate to ${r.name} folder`,children:r.name})]},r.id))]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(de,{className:"w-8 h-8",children:[e.jsx(me,{src:o==null?void 0:o.avatar}),e.jsx(he,{className:"bg-gray-600 text-gray-200",children:(G=o==null?void 0:o.name)==null?void 0:G.charAt(0)})]})})]})}),e.jsx("div",{className:"bg-[#1a1f2e] border-b border-gray-700 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:a&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>{const r=s.find(c=>c.id===a);N((r==null?void 0:r.parentId)||null)},className:"text-gray-400 hover:text-gray-200 hover:bg-gray-800",children:e.jsx(pe,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx(P,{type:"text",placeholder:"Search files and folders...",value:h,onChange:r=>te(r.target.value),className:"pl-10 pr-4 py-2 w-80 bg-[#0f1419] border-gray-600 text-gray-200 placeholder-gray-500"})]}),d.size>0&&e.jsxs(f,{variant:"destructive",size:"sm",onClick:re,disabled:t,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Delete (",d.size,")"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>C(!0),className:"bg-[#0f1419] border-gray-600 text-gray-300 hover:bg-gray-800",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"New Folder"]}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs(f,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Upload Files"]}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf",onChange:r=>k(r.target.files),className:"hidden"})]})]})]})}),e.jsxs("div",{className:`flex-1 p-6 overflow-auto ${Q?"bg-blue-900/20 border-2 border-dashed border-blue-400":""}`,onDragOver:_,onDragLeave:q,onDrop:ee,children:[Q&&e.jsx("div",{className:"fixed inset-0 bg-blue-900/50 flex items-center justify-center z-10",children:e.jsxs("div",{className:"bg-[#1a1f2e] p-8 rounded-lg shadow-lg border-2 border-dashed border-blue-400",children:[e.jsx(E,{className:"w-12 h-12 text-blue-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-blue-400",children:"Drop PDF files here to upload"})]})}),t?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(V,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-400",children:"Loading..."})]}):e.jsx(e.Fragment,{children:S.folders.length===0&&S.files.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-200 mb-2",children:h?"No results found":"This folder is empty"}),e.jsx("p",{className:"text-gray-400 mb-6",children:h?"Try adjusting your search terms":"Upload some PDF files or create folders to get started"}),!h&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs(f,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Upload your first file"]}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf",onChange:r=>k(r.target.files),className:"hidden"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[S.folders.map(r=>e.jsxs("div",{className:`group relative p-4 bg-[#1a1f2e] rounded-lg border-2 transition-all cursor-pointer hover:shadow-md hover:border-gray-600 ${d.has(r.id)?"border-blue-500 bg-blue-900/20":"border-gray-700"}`,onClick:()=>{if(d.size>0){const c=new Set(d);c.has(r.id)?c.delete(r.id):c.add(r.id),F(c)}else N(r.id)},children:[e.jsx("input",{type:"checkbox",checked:d.has(r.id),onChange:c=>{c.stopPropagation();const n=new Set(d);c.target.checked?n.add(r.id):n.delete(r.id),F(n)},className:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(f,{variant:"ghost",size:"sm",onClick:c=>{c.stopPropagation()},className:"p-1 text-gray-400 hover:text-gray-200 rounded w-6 h-6",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-12 h-12 text-blue-400 mx-auto mb-3"}),e.jsx("h3",{className:"font-medium text-gray-200 truncate",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[r.itemCount," items"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r.createdAt})]})]},r.id)),S.files.map(r=>{var c,n;return e.jsxs("div",{className:`group relative p-4 bg-[#1a1f2e] rounded-lg border-2 transition-all cursor-pointer hover:shadow-md hover:border-gray-600 ${d.has(r.id)?"border-blue-500 bg-blue-900/20":"border-gray-700"}`,onClick:()=>{const i=new Set(d);i.has(r.id)?i.delete(r.id):i.add(r.id),F(i)},onDoubleClick:()=>ae(r),children:[e.jsx("input",{type:"checkbox",checked:d.has(r.id),onChange:i=>{i.stopPropagation();const w=new Set(d);i.target.checked?w.add(r.id):w.delete(r.id),F(w)},className:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),se(r)},className:"p-1 text-gray-400 hover:text-gray-200 rounded w-6 h-6",children:e.jsx(we,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),le(r.id)},className:"p-1 text-gray-400 hover:text-gray-200 rounded w-6 h-6",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(Fe,{className:"w-12 h-12 text-red-400 mx-auto mb-3"}),e.jsx("h3",{className:"font-medium text-gray-200 truncate",title:r.name,children:r.name}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-2",children:[oe(((c=r.metadata)==null?void 0:c.accessLevel)||"private"),e.jsx("p",{className:"text-sm text-gray-400",children:ce(r.size)})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(r.createdAt).toLocaleDateString()}),((n=r.metadata)==null?void 0:n.sharedWith)&&r.metadata.sharedWith.length>0&&e.jsxs("div",{className:"flex items-center justify-center mt-1",children:[e.jsx(J,{className:"w-3 h-3 text-gray-500 mr-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:r.metadata.sharedWith.length===1&&r.metadata.sharedWith[0]==="public"?"Public":`${r.metadata.sharedWith.length} users`})]})]})]},r.id)})]})})]}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[#1a1f2e] rounded-lg p-6 w-96 border border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-200",children:"Create New Folder"}),e.jsx(P,{type:"text",placeholder:"Folder name",value:j,onChange:r=>D(r.target.value),onKeyPress:r=>r.key==="Enter"&&W(),className:"w-full bg-[#0f1419] border-gray-600 text-gray-200 placeholder-gray-500",autoFocus:!0}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx(f,{variant:"outline",onClick:()=>{C(!1),D("")},className:"flex-1 bg-[#0f1419] border-gray-600 text-gray-300 hover:bg-gray-800",children:"Cancel"}),e.jsxs(f,{onClick:W,disabled:!j.trim()||t,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[t?e.jsx(V,{className:"w-4 h-4 animate-spin mr-2"}):null,"Create"]})]})]})}),Y&&O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[#1a1f2e] rounded-lg p-6 w-96 border border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-200",children:['Share "',O.name,'"']}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Access Level"}),e.jsxs("select",{className:"w-full px-3 py-2 bg-[#0f1419] border border-gray-600 rounded-lg text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent","aria-label":"Select access level",children:[e.jsx("option",{value:"view",children:"View Only"}),e.jsx("option",{value:"edit",children:"Can Edit"}),e.jsx("option",{value:"private",children:"Private"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Share with"}),e.jsx(P,{type:"email",placeholder:"Enter email address",className:"w-full bg-[#0f1419] border-gray-600 text-gray-200 placeholder-gray-500"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx(f,{variant:"outline",onClick:()=>{B(!1),T(null)},className:"flex-1 bg-[#0f1419] border-gray-600 text-gray-300 hover:bg-gray-800",children:"Cancel"}),e.jsx(f,{className:"flex-1 bg-blue-600 hover:bg-blue-700",children:"Share"})]})]})})]})}export{Qe as default};
