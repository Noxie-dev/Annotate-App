import{j as e}from"./radix-ui-Dm4GcI-M.js";import{a as p}from"./react-vendor-BxpQIQ7B.js";import{D as L,P as M,a as R,b as T}from"./pdf-vendor-BQ5_-Qxz.js";import{b as k}from"./index-CeiQEl0I.js";import{B as v}from"./button-BU14-tcR.js";import{I as z}from"./input-B_Pc9ca6.js";import{ae as I,H as E,I as A,af as F,ag as _,ah as $,ai as W,aj as B,D as O,ak as Z}from"./utils-vendor-DzewcVAv.js";/* empty css                  */import"./data-vendor-7zrJSdJt.js";function U({annotations:o,scale:a,pageNumber:y}){const i=p.useRef(null),{currentTool:l,addAnnotation:x,selectedAnnotation:u,setSelectedAnnotation:N,users:w}=k(),[g,b]=p.useState(!1),[h,j]=p.useState([]);p.useEffect(()=>{const s=i.current;if(!s)return;const t=s.getContext("2d");t&&(t.clearRect(0,0,s.width,s.height),o.forEach(r=>{P(t,r,a)}))},[o,a]);const P=(s,t,r)=>{const n=w.find(d=>d.id===t.userId),c=(n==null?void 0:n.color)||t.color;switch(s.save(),t.type){case"highlight":s.fillStyle=c+"40",s.fillRect(t.x*r,t.y*r,(t.width||0)*r,(t.height||0)*r);break;case"rectangle":s.strokeStyle=c,s.lineWidth=2,s.strokeRect(t.x*r,t.y*r,(t.width||0)*r,(t.height||0)*r);break;case"drawing":if(t.path){s.strokeStyle=c,s.lineWidth=(t.strokeWidth||2)*r,s.lineCap="round",s.lineJoin="round";const d=new Path2D(t.path);s.stroke(d)}break;case"text-comment":s.fillStyle=c,s.beginPath(),s.arc(t.x*r,t.y*r,8*r,0,2*Math.PI),s.fill(),s.fillStyle="white",s.font=`${10*r}px Arial`,s.textAlign="center",s.textBaseline="middle",s.fillText("ðŸ’¬",t.x*r,t.y*r);break}(u==null?void 0:u.id)===t.id&&(s.strokeStyle="#3b82f6",s.lineWidth=3,s.setLineDash([5,5]),s.strokeRect((t.x-5)*r,(t.y-5)*r,((t.width||20)+10)*r,((t.height||20)+10)*r)),s.restore()},m=s=>{if(l.type==="select")return;const t=i.current;if(!t)return;const r=t.getBoundingClientRect(),n=(s.clientX-r.left)/a,c=(s.clientY-r.top)/a;b(!0),j([{x:n,y:c}])},C=s=>{if(!g||l.type==="select")return;const t=i.current;if(!t)return;const r=t.getBoundingClientRect(),n=(s.clientX-r.left)/a,c=(s.clientY-r.top)/a;j(f=>[...f,{x:n,y:c}]);const d=t.getContext("2d");if(d&&l.type==="draw"&&(d.strokeStyle=l.color||"#3b82f6",d.lineWidth=(l.size||2)*a,d.lineCap="round",d.lineJoin="round",h.length>1)){const f=h[h.length-2];d.beginPath(),d.moveTo(f.x*a,f.y*a),d.lineTo(n*a,c*a),d.stroke()}},D=s=>{if(!g||(b(!1),h.length<2))return;const t={id:`annotation-${Date.now()}`,type:l.type,pageNumber:y,x:h[0].x,y:h[0].y,color:l.color||"#3b82f6",userId:"user-1",timestamp:new Date().toISOString(),strokeWidth:l.size||2};if(l.type==="draw"){const r=h.reduce((n,c,d)=>d===0?`M${c.x},${c.y}`:n+` L${c.x},${c.y}`,"");t.path=r}else if(l.type==="rectangle"){const r=h[h.length-1];t.width=Math.abs(r.x-h[0].x),t.height=Math.abs(r.y-h[0].y)}x(t),j([])},S=s=>{if(l.type!=="select")return;const t=i.current;if(!t)return;const r=t.getBoundingClientRect(),n=(s.clientX-r.left)/a,c=(s.clientY-r.top)/a,d=o.find(f=>n>=f.x&&n<=f.x+(f.width||20)&&c>=f.y&&c<=f.y+(f.height||20));N(d||null)};return e.jsx("canvas",{ref:i,width:800*a,height:1e3*a,className:"absolute top-0 left-0 cursor-crosshair",style:{width:`${800*a}px`,height:`${1e3*a}px`,pointerEvents:"auto"},onMouseDown:m,onMouseMove:C,onMouseUp:D,onClick:S})}function X(){const{currentPage:o,totalPages:a,setCurrentPage:y}=k(),i=w=>{const g=parseInt(w.target.value);g>=1&&g<=a&&y(g)},l=()=>y(1),x=()=>y(a),u=()=>y(Math.max(1,o-1)),N=()=>y(Math.min(a,o+1));return e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-20",children:e.jsxs("div",{className:"bg-[#1a1f2e] rounded-lg border border-gray-700 p-2 flex items-center space-x-2 shadow-lg",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:l,disabled:o<=1,className:"text-gray-400 hover:text-gray-200",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:u,disabled:o<=1,className:"text-gray-400 hover:text-gray-200",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{type:"number",min:1,max:a,value:o,onChange:i,className:"w-16 h-8 text-center bg-[#0f1419] border-gray-600 text-gray-200"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["of ",a]})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:N,disabled:o>=a,className:"text-gray-400 hover:text-gray-200",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:x,disabled:o>=a,className:"text-gray-400 hover:text-gray-200",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("div",{className:"h-4 w-px bg-gray-700"}),e.jsx(v,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-200",children:e.jsx(_,{className:"w-4 h-4"})})]})})}function Y({pageNumber:o,scale:a}){const{userPresence:y,users:i}=k(),l=y.filter(x=>x.pageNumber===o&&x.isActive);return e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:l.map(x=>{const u=i.find(N=>N.id===x.userId);return!u||u.id==="user-1"?null:e.jsx("div",{className:"absolute transition-all duration-150 ease-out",style:{left:x.x*a,top:x.y*a,zIndex:1e3},children:e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"w-5 h-5 transform -rotate-12",style:{color:u.color}}),e.jsx("div",{className:"absolute top-5 left-2 px-2 py-1 rounded text-xs text-white shadow-lg whitespace-nowrap",style:{backgroundColor:u.color},children:u.name})]})},x.userId)})})}T.workerSrc=`//unpkg.com/pdfjs-dist@${R}/build/pdf.worker.mjs`;function se(){const{currentDocument:o,currentPage:a,totalPages:y,scale:i,setScale:l,setCurrentPage:x,annotations:u}=k(),[N,w]=p.useState(0),[g,b]=p.useState(!0),[h,j]=p.useState(null),P=p.useRef(null),m=p.useRef(null);p.useEffect(()=>(g&&o&&(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{g&&(j("PDF loading timed out. Please check your connection and try again."),b(!1))},3e4)),()=>{m.current&&clearTimeout(m.current)}),[g,o]);const C=({numPages:n})=>{console.log("PDF loaded successfully, pages:",n),m.current&&(clearTimeout(m.current),m.current=null),w(n),b(!1),j(null)},D=n=>{console.error("PDF load error:",n),console.error("Document file path:",o==null?void 0:o.filePath),m.current&&(clearTimeout(m.current),m.current=null),j(`Failed to load PDF document: ${n.message}`),b(!1)},S=()=>{l(i+.2)},s=()=>{l(i-.2)},t=()=>{if(o){const n=document.createElement("a");n.href=o.filePath,n.download=o.fileName,n.click()}},r=u.filter(n=>n.pageNumber===a);return o?e.jsxs("div",{className:"relative h-full flex flex-col bg-[#0f1419]",children:[e.jsx("div",{className:"absolute top-4 left-4 z-20",children:e.jsxs("div",{className:"bg-[#1a1f2e] rounded-lg border border-gray-700 p-2 flex items-center space-x-2 shadow-lg",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:s,disabled:i<=.5,className:"text-gray-400 hover:text-gray-200",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-sm text-gray-300 px-2",children:[Math.round(i*100),"%"]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:S,disabled:i>=3,className:"text-gray-400 hover:text-gray-200",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx("div",{className:"h-4 w-px bg-gray-700"}),e.jsx(v,{variant:"ghost",size:"sm",onClick:t,className:"text-gray-400 hover:text-gray-200",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx(v,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-200",children:e.jsx(Z,{className:"w-4 h-4"})})]})}),e.jsxs("div",{ref:P,className:"flex-1 overflow-auto bg-gray-900 flex items-center justify-center relative",children:[g&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading document..."})]})}),h&&e.jsxs("div",{className:"text-center max-w-md mx-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-medium text-red-400 mb-2",children:"Error Loading Document"}),e.jsx("p",{className:"text-gray-400 mb-4",children:h}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{onClick:()=>{j(null),b(!0),window.location.reload()},className:"bg-blue-600 hover:bg-blue-700",children:"Retry Loading"}),e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-800/50 p-3 rounded-lg",children:[e.jsx("p",{className:"font-medium mb-2",children:"Troubleshooting tips:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-left",children:[e.jsx("li",{children:"Check your internet connection"}),e.jsx("li",{children:"Ensure the PDF file exists and is accessible"}),e.jsx("li",{children:"Verify PDF.js worker is loading correctly"}),e.jsx("li",{children:"Try refreshing the page"})]})]})]})]}),!g&&!h&&e.jsx("div",{className:"relative",children:e.jsx(L,{file:o.filePath,onLoadSuccess:C,onLoadError:D,loading:null,error:null,className:"relative",children:e.jsxs("div",{className:"relative bg-white shadow-2xl",children:[e.jsx(M,{pageNumber:a,scale:i,renderTextLayer:!0,renderAnnotationLayer:!1,className:"relative"}),e.jsx(U,{annotations:r,scale:i,pageNumber:a}),e.jsx(Y,{pageNumber:a,scale:i})]})})})]}),e.jsx(X,{})]}):null}export{se as PDFViewer};
